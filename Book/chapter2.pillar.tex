% -*- mode: latex; -*-
\ifx\wholebook\relax\else

	% Lulu:
	\documentclass[a4paper,10pt,twoside]{book}
	\usepackage[
		papersize={6.13in,9.21in},
		hmargin={.75in,.75in},
		vmargin={.75in,1in},
		ignoreheadfoot
	]{geometry}
	\input{../support/latex/common.tex}
	% \input{../support/latex/commonLuaTex.tex}
	\setboolean{lulu}{true}
% --------------------------------------------
% A4:
%	\documentclass[a4paper,11pt,twoside]{book}
%	\input{../support/latex/common.tex}
%	\usepackage{a4wide}
% --------------------------------------------    
\graphicspath{
	{figures/}
	{../figures/}
}

\begin{document}
\fi
\sloppy

\chapter{ Introduction to Simple Epidemic Model}\label{ Introduction to Simple Epidemic Model}\section{ Simple SIR (without births and deaths)}\label{ Simple SIR (without births and deaths)}
Program 2.1 is a simple SIR model (page 19 of the book). These are the equations and the code of the model:
\subsection{ Equations}\label{ Equations}

\begin{equation}
\frac{dS}{dt} = -\beta*S*I
\end{equation}
\begin{equation}
\frac{dI}{dt} = \beta*S*I-\gamma*I
\end{equation}
\begin{equation}
\frac{dR}{dt} = \gamma*I
\end{equation}
\subsection{ Pharo code}\label{ Pharo code}
% syntax highlighting = smalltalk

\begin{code}{}
|solver system dt beta gamma values stepper diag colors maxTime|
dt := 1.0.
beta := 1.4247.
gamma := 0.14286.
maxTime := 70.0.
system := ExplicitSystem block: [ :x :t| |c|
     c := Array new: 3.
     c at: 1 put: (beta negated) * (x at: 1) * (x at: 2).
     c at: 2 put: (beta * (x at: 1) * (x at: 2)) - (gamma * (x at: 2)).
     c at: 3 put: gamma * (x at: 2).
     c
     ].
stepper := RungeKuttaStepper onSystem: system.
solver := (ExplicitSolver new) stepper: stepper; system: system; dt: dt.
state := { 1-1e-6. 1e-6. 0}.
values := (0.0 to: maxTime by: dt) collect: [ :t| |state| state := stepper doStep: state
                                                          time: t stepSize: dt ].
diag := OrderedCollection new.
colors := Array with: Color blue with: Color red with: Color green.
1 to: 3 do: [ :i|
    diag add:
        ((GETLineDiagram new)
            models: (1 to: maxTime+1 by: 1);
            y: [ :x| (values at: x) at: i ];
            color: (colors at: i))
     ].
builder := (GETDiagramBuilder new).
builder compositeDiagram
    xAxisLabel: 'Time in days';
    yAxisLabel: 'Number of Individuals';
    regularAxis;
    diagrams: diag.
builder open.
\end{code}

\section{ SIR model with births and deaths}\label{ SIR model with births and deaths}\subsection{ Equations}\label{ Equations}

\begin{equation}
\frac{dS}{dt} = \mu-\beta*S*I-\mu*S
\end{equation}
\begin{equation}
\frac{dI}{dt} = \beta*S*I-\gamma*I-\mu*I
\end{equation}
\begin{equation}
\frac{dR}{dt} = \gamma*I-\mu*R
\end{equation}
\subsection{ Pharo code}\label{ Pharo code}
% syntax highlighting = smalltalk

\begin{code}{}
|solver system dt beta gamma values stepper diag mu colors maxTime|
dt := 1.0.
mu := 1/(70*365.0).
beta := 520/365.0.
gamma := 1/7.0.
maxTime := 60*365.
system := ExplicitSystem block: [ :x :t| |c|
     c := Array new: 3.
     c at: 1 put: mu - (beta  * (x at: 1) * (x at: 2)) - (mu * (x at:1)).
     c at: 2 put: (beta * (x at: 1) * (x at: 2)) - (gamma * (x at: 2)) - (mu * (x at:2)).
     c at: 3 put: (gamma * (x at: 2)) - (mu * (x at: 2)).
     c
     ].

stepper := RungeKuttaStepper onSystem: system.
solver := (ExplicitSolver new) stepper: stepper; system: system; dt: dt.
state := { 0.1. 1e-4. 1-0.1-1e-4}.
values := (0.0 to: maxTime by: dt) collect: [ :t| |state| state := stepper doStep: state
                                                          time: t stepSize: dt ].
diag := OrderedCollection new.
colors := Array with: Color blue with: Color red with: Color green.
1 to: 3 do: [ :i|
    diag add:
        ((GETLineDiagram new)
            models: (1 to: maxTime+1 by: 1);
            y: [ :x| (values at: x) at: i ];
            color: (colors at: i))
     ].
builder := (GETDiagramBuilder new).
builder compositeDiagram
    xAxisLabel: 'Time in days';
    yAxisLabel: 'Number of Individuals';
    regularAxis;
    diagrams: diag.
builder open.
\end{code}

\section{ SIR model with disease induced mortality and density dependent transmission}\label{ SIR model with disease induced mortality and density dependent transmission}\subsection{ Equations}\label{ Equations}

\begin{equation}
\frac{dX}{dt} = \nu-\beta*X*Y-\mu*X
\end{equation}
\begin{equation}
\frac{dY}{dt} = \beta*X*Y-\frac{\gamma+\mu}{1-\rho}*Y
\end{equation}
\begin{equation}
\frac{dZ}{dt} = \gamma*Y-\mu*Z
\end{equation}
\section{ SIR model, disease induced mortality and frequency dependent transmission}\label{ SIR model, disease induced mortality and frequency dependent transmission}\subsection{ Equations}\label{ Equations}

\begin{equation}
\frac{dX}{dt} = \nu-\beta*X*Y/N-\mu*X
\end{equation}
\begin{equation}
\frac{dY}{dt} = \beta*X*Y/N-\frac{\gamma+\mu}{1-\rho}*Y
\end{equation}
\begin{equation}
\frac{dZ}{dt} = \gamma*Y-\mu*Z
\end{equation}
\subsection{ Pharo code}\label{ Pharo code}\section{ SIS model without births or deaths}\label{ SIS model without births or deaths}\subsection{Equations}\label{Equations}

\begin{equation}
\frac{dS}{dt} = \gamma*I-\beta*S*I
\end{equation}
\begin{equation}
\frac{dI}{dt} = \beta*S*I-\gamma*I
\end{equation}
\section{ SEIR model with births and deaths}\label{ SEIR model with births and deaths}\section{ SIR with a carrier state}\label{ SIR with a carrier state}


\ifx\wholebook\relax\else
   \bibliographystyle{jurabib}
   \nobibliography{scg}\end{document}
\fi
